# GTD-mathematical-modeling
2015 "华为杯" Mathematical modeling 
## 问题分析
全球恐怖主义数据库统计了非国家行为者通过恐惧和胁迫实现政治，经济，宗教或社会目标的暴力案件。根据这个定义，该数据库包括2015年查尔斯顿射击等意识形态动机攻击的案例，但不包括同样可怕的但是不是政治驱动的攻击，如2016年的极光射击。由于恐怖袭击明显地影响着人类生活，也会对国际政治、公民自由和经济等造成严重冲击，所以对恐怖袭击事件数据进行统计分析和建模对于确定未来防范有重要的参考意义。
- 针对任务一，先挑选出与危险等级相关的事件属性，通过综合对比K-Means算法和AFW-Kmeans算法的性能后，使用AFW-Kmeans算法先对所有恐怖袭击事件进行聚类分析，然后根据聚类结果得到的危险程度中心挑选关键属性进行加权计算得分，根据得分可以划分每个危险等级中心的危险等级，对于全球10大恐怖事件按照距离危险等级中心最近的事件取出其中前10个即可，分析典型事件的危害级别，计算待分析事件到各个危险等级中心的距离，选取最近的危险等级中心，然后将待分析事件的危险等级划分到这个所属危险等级中心的级别，完成表1内容。
- 针对任务二，分析数据得知，2015年和2016年度发生的、尚未有组织或个人宣称负责的恐怖袭击事件占了数据的少部分，我们无法利用2015年和2016年的数据进行单独建模。针对此问题，我们使用1998年至2017年的有组织或个人名称的样本集视作有标签的部分，作为接下来建立模型的数据。将未有组织或个人宣称负责的事件作为测试集，利用多层感知机和随机森林分类算法将可能是同一个组织或个人在不同时间、不同地点多次作案的若干案件进行分类预测。
在上一阶段完成的基础上，针对嫌疑程度排序问题，对表2列出的恐袭事件，采用了K近邻分类算法。根据预测事件距离所属类别样本点的欧式距离，进行前五名的排序，完成表2内容。分别对2015、2016年发生的未知事件进行相似案件的归类，利用随机森林选取出最有可能的五个嫌疑人，结合表2给定的典型事件，使用kNN依据距离作为划分嫌疑程度的标准，对给定事件的嫌疑人进行排序。
- 针对任务三，对近三年来恐怖袭击事件的样本通过时间序列预测框架Prophet进行了建模，通过数据分析，找出了前三名易遭受恐怖袭击的国家。我们发现这些热点地区存在着一定的共性，比如都信仰伊斯兰教。所以将节假日和恐怖袭击事件进行关联，在与日期相关的几个维度上，分析得出了几个热点地区在2018年的反恐态势。以及结合数据所呈现出的蔓延特性和级别分布等规律，提出了反恐斗争的见解和建议。
- 针对任务四，为了利用恐怖袭击事件数据集，建立了两种模型。第一，通过数据分析结合互联网资料显示，恐怖组织或个人采用一定的战术，引起人们的恐惧和迫使政府向恐怖分子屈服。这些战术包括抢劫、刺杀、临时爆炸装置等，因此十分有必要对恐怖分子所携带的武器进行分类，以做好针对该武器的防范措施。使用数据进行了SVM算法模型的构建，从而得到未知事件可能采用的武器类型，以有效提高反恐斗争的针对性。第二，从自然语言处理角度出发，使用Seq2Seq模型根据输入数据（样本中summary字段文本内容）预测发生恐怖袭击事件的country_txt国家信息，对恐怖袭击事件的文本描述内容进行分析挖掘出有用信息.

## 任务1 依据危害性对恐怖袭击事件分级
对灾难性事件比如地震、交通事故、气象灾害等等进行分级是社会管理中的重要工作。通常的分级一般采用主观方法，由权威组织或部门选择若干个主要指标，强制规定分级标准，如我国《道路交通事故处理办法》第六条规定的交通事故等级划分标准，主要按照人员伤亡和经济损失程度划分。
但恐怖袭击事件的危害性不仅取决于人员伤亡和经济损失这两个方面，还与发生的时机、地域、针对的对象等等诸多因素有关，因而采用上述分级方法难以形成统一标准。请你们依据附件1以及其它有关信息，结合现代信息处理技术，借助数学建模方法建立基于数据分析的量化分级模型，将附件1给出的事件按危害程度从高到低分为一至五级，列出近二十年来危害程度最高的十大恐怖袭击事件，并给出表1中事件的分级。

表1 典型事件危害级别

事件编号 | 危害级别
--|--
200108110012|1
200511180002|2
200901170021|1
201402110015|3
201405010071| 1
201411070002|	 2 
201412160041|	4
201508010015|	 1 
201705080012| 	5
### 任务一解决方案
### 首先数据预处理
恐怖袭击事件的数据中有些特征与问题求解无关且有数据不一致等诸多问题，严重影响到数据挖掘建模的执行效率和结果。数据预处理过程如下：
- 第一步，计算每个属性的空值总数和百分比。结果显示，许多属性的缺失值超过50％，对于缺失值较多的属性，由此选择缺失值小于20％且不与其他属性相似的属性列表 用于接下来的建模。
- 第二步，因为对缺失值进行分类会给模型造成一定的分类障碍，所以我们修复了缺失值。其中包括原始数据空白值，-9，-99。为了保持一致性，规定-1用于数字的分类属性，Unknown用于文本的分类属性，数字属性将替换为NAN。部分属性由于平均值不稳定且受异常值的影响较大，我们采用中值进行插补。
- 第三步，由于很多属性是用Yes/No/Unknown进行标记的，这种标记方法不利于我们进行数据分析，用1，0，-1分别表示“Yes”，“No”和“Unknow“。 不止这些，用数字标签替换数据集中的其他文本属性以改进原始数据集。
- 第四步，由于不同评价指标往往具有不同的量纲，数值间的差别可能很大，不进行处理可能会影响到数据分析的结果。为了消除指标之间的量纲和取值范围差异的影响，需要进行标准化处理，将数据按照比例进行缩放，使其落入一个特定的区域，便于进行综合分析。实验预处理部分采用的是最小-最大规范化，对原始数据进行线性变换，将数值映射到[0,1]之间。进行数据规范化的特征有：'nperpcap', 'nkill', 'nkillus', 'nkillter', 'nwound', 'nwoundus', 'nwoundte'。
- 第五步：用随机森林模型挑选出来了前20个重要特征，根据互联网查找资料所显示的“恐怖袭击事件”的广泛定义，作为接下来每个任务的具体求解参照，删除了不属于此范畴内的特征，利用符合每个任务题意的特征进行了建模。前20个重要特征有：

随机森林产生的20个特征：
iyear | region_txt_South Asia	| INT_IDEO_txt_YES | natlty1_txt_Iraq | INT_ANY_txt_YES
region_txt_Middle East&North Africa | country_txt_Iraq | country_txt_Somalia | iday|imonth
region_txt_Sub-Saharan Africa | INT_LOG_txt_UKNOWN | INT_IDEO_txt_UKNOWN | nkill | INT_ANY_txt_UKNOWN
country_txt_Pakistan | natlty1_txt_Somalia | natlty1_txt_India | natlty1_txt_Pakistan | natlty1_txt_Nigeria

- 采用kmeans处理任务
K-Means是对距离聚类中的一种方法，通过计算距离的大小计算恐怖事件的相似性程度，从而实现相似数据的合并。

<img src="https://github.com/michelleweii/GTD-mathematical-modeling/blob/master/数学建模git上传/kmenas.PNG" width="500" alt="note3">

- 采用改进的kmeans处理任务

<img src="https://github.com/michelleweii/GTD-mathematical-modeling/blob/master/数学建模git上传/awkmeans.PNG" width="500" alt="note3">

## 任务2 依据事件特征发现恐怖袭击事件制造者
附件1中有多起恐怖袭击事件尚未确定作案者。如果将可能是同一个恐怖组织或个人在不同时间、不同地点多次作案的若干案件串联起来统一组织侦査，有助于提高破案效率，有利于尽早发现新生或者隐藏的恐怖分子。请你们针对在2015、2016年度发生的、尚未有组织或个人宣称负责的恐怖袭击事件，运用数学建模方法寻找上述可能性，即将可能是同一个恐怖组织或个人在不同时间、不同地点多次作案的若干案件归为一类，对应的未知作案组织或个人标记不同的代号，并按该组织或个人的危害性从大到小选出其中的前5个，记为1号-5号。再对表2列出的恐袭事件，按嫌疑程度对5个嫌疑人排序，并将结果填入下表（表中样例的意思是：对事件编号为XX的事件，3号的嫌疑最大，其次是4号，最后是5号），如果认为某嫌疑人关系不大，也可以保留空格。

表2 恐怖分子关于典型事件的嫌疑度

 1号嫌疑人 |	2号嫌疑人	| 3号嫌疑人	| 4号嫌疑人	| 5号嫌疑人
--|--|--|--|--
201701090031	|2|	1|	3|	5|	4
201702210037	|1	|2	|3	|5|	4
201703120023	|2	|3	|1	|5|	4
201705050009	|3	|1	|2	|4	|5
201705050010	|3	|1	|2	|3	|5
201707010028	|1	|3	|2	|5	|4
201707020006	|2	|1	|3	|5	|4
201708110018	|1	|2	|3	|5	|4
201711010006	|2	|1	|3	|5	|4
201712010003	|2	|1	|3	|5	|4


### 任务二解决方案
由于数据集中部分数据的缺失，有多起恐怖袭击事件尚未确定作案者。任务二要求确定2015年、2016年度发生的、尚未由组织或个人宣称负责的恐怖事件，按照一定规律找出相似事件的类别，将其归为一类。在此基础上，选出组织或个人的危害程度排名前5的完成表2任务。本任务首先对未知事件通过随机森林算法建模进行分类任务，通过数据分析得出排名前5的组织，标记为1-5号，之后通过k-近邻算法建模找到与未知恐怖事件有嫌疑的5个嫌疑人。
- 随机森林首先由多棵分类回归树（Classification And Regression Tree,CART）构成，采用自助采样法(boostrap sample)得到差异化训练样本数据集，对于单颗决策树，在选择特征构建时采用随机子空间划分(random subspace method)策略，也就是说随机选择部分属性构成单棵决策树，并从中挑选最佳属性进行属性分裂。
因此，结合本任务的具体要求随机森林的训练过程可以总结如下。

<img src="https://github.com/michelleweii/GTD-mathematical-modeling/blob/master/数学建模git上传/RF.PNG" width="500" alt="note3">

- k近邻（k-Nearest Neighbor，简称kNN）是一种基于某种距离度量对训练样本进行分类的算法。由于按照距离对样本进行度量，所以可以找出本任务预测恐怖袭事件的嫌疑人。具体解题思路是：在表2给定的10个测试样本中，根据度量距离找出在特征空间中的5个最相似样本，然后根据找到的这5个最邻近样本的信息进行分类预测，在分类预测过程中，通常遵循“投票法则”，即在这10个样本中出现最多的类别作为预测结果。通过sk-learn中的predict_proba函数可以输出所有类别的预测结果，我们按照降序顺序完成对表2的填写。

<img src="https://github.com/michelleweii/GTD-mathematical-modeling/blob/master/数学建模git上传/knn-1.PNG" width="500" alt="note3">
<img src="https://github.com/michelleweii/GTD-mathematical-modeling/blob/master/数学建模git上传/knn-2.PNG" width="500" alt="note3">

## 任务3 对未来反恐态势的分析
对未来反恐态势的分析评估有助于提高反恐斗争的针对性和效率。请你们依据附件1并结合因特网上的有关信息，建立适当的数学模型，研究近三年来恐怖袭击事件发生的主要原因、时空特性、蔓延特性、级别分布等规律，进而分析研判下一年全球或某些重点地区的反恐态势，用图/表给出你们的研究结果，提出你们对反恐斗争的见解和建议。
### 任务三解决方案
   针对该问题，有多种方法可以达到时间序列预测的结果。我们采用了时间序列预测框架Prophet[2]。对由数据分析结果显示的重点地区进行了下一年的恐怖袭击态势的预测。针对恐怖袭击发生的规律从主要原因、蔓延特性、级别分布等方面做了数据分析可视化，从而实现了此任务的目标，并在结果分析中对反恐斗争提出了见解和建议。
- 时间序列模型

在针对于该问题的解决，应用了Facebook开源的时间序列预测算法。Prophet是一种基于加性模型预测时间序列数据的程序，其中非线性趋势能够拟合每一年，每一周和每一日。它对于缺失数据和趋势的变化是非常有效的，通常很好地处理异常值，并且适用于具有强烈季节性影响的历史数据的时间序列。因为从数据分析中得出易发生恐怖袭击的国家大多数都是信奉伊斯兰教的国家，教徒们通常会根据节日做相应的祷告活动，我们大胆推断发生恐怖袭击事件的日期与他们节假日之间有着一定的关联，结果显示也证实了我们猜想的正确性。Prophet是一个可加回归模型，也就是把模型分为趋势模型、周期模型、节假日以及随机噪声的叠加。它由四个组成部分：

<img src="https://github.com/michelleweii/GTD-mathematical-modeling/blob/master/数学建模git上传/时间序列预测框架.PNG" width="300" alt="note3">

1.一个分段的线性或逻辑增长曲线趋势。Prophet通过提取数据中的转变点，自动检测趋势变化。

2.一个按年的周期组建，使得傅里叶级数建模而成。

3.一个按周的周期组建，使得虚拟变量建模而成。

4.用户设置重要节日表。
通过对时空特性进行建模。分析得到了下一年（2018年）全球或某些重点地区的反恐态势。通过数据分析得出1998年至2017年排名前20易受到恐怖袭击的国家，如图所示。
<img src="https://github.com/michelleweii/GTD-mathematical-modeling/blob/master/数学建模git上传/assignment3/图%204-6%20易遭受恐怖袭击国家排名.png" width="800" alt="note3">

前五名的是Iraq、Pakistan、Afghanistan、India、Philippines。所以，在解决研判下一年某些重点地区的反恐态势问题中，我们挑选了排名前三的国家，分别是伊拉克共和国、巴基斯坦伊斯兰共和国、阿富汗伊斯兰共和国进行时序建模，从而预测下一年（2018年）的反恐态势。以下只分析伊拉克的预测结果。
针对于Prophet适用的场景和本任务的描述，相似的情况有： 1、事先知道的以不定期的间隔发生的重要节假日；2、缺失的历史数据或较大的异常数据的数量在合理范围内；3、有历史趋势的变化；4、对于数据中蕴含的非线性增长的趋势都有一个自然极限或饱和状态。Prophet是一种类似generalized additive model(GAM)的模型，不同于以往的时间序列预测模型（例如ARIMA），Prophet模型将预测问题视作曲线拟合问题。时间序列中无需有一个固定的周期，也不需要在拟合前对缺失值进行填补，这是传统的（例如ARIMA）模型所办不到的。
以下是对伊拉克的恐怖袭击事件和节假日之间创建时间序列模型求解结果。

<img src="https://github.com/michelleweii/GTD-mathematical-modeling/blob/master/数学建模git上传/assignment3/图%204-7%20伊拉克每日所遭受的恐怖袭击数量.png" width="800" alt="note3">
图 伊拉克每日所遭受的恐怖袭击数量

<img src="https://github.com/michelleweii/GTD-mathematical-modeling/blob/master/数学建模git上传/assignment3/图%204-8%20伊拉克每日所遭受的恐怖袭击数量——平滑后.png" width="800" alt="note3">
图 伊拉克每日所遭受的恐怖袭击数量——平滑后

<img src="https://github.com/michelleweii/GTD-mathematical-modeling/blob/master/数学建模git上传/assignment3/图%204-9%20伊拉克每周所遭受的恐怖袭击数量.png" width="800" alt="note3">
图 伊拉克每周所遭受的恐怖袭击数量

<img src="https://github.com/michelleweii/GTD-mathematical-modeling/blob/master/数学建模git上传/assignment3/图%204-10%20伊拉克每月所遭受的恐怖袭击数量.png" width="800" alt="note3">
图 伊拉克每月所遭受的恐怖袭击数量

<img src="https://github.com/michelleweii/GTD-mathematical-modeling/blob/master/数学建模git上传/assignment3/图%204-11%20预测%202018%20年伊拉克地区恐怖袭击趋势.png" width="800" alt="note3">
图 预测2018年伊拉克地区恐怖袭击趋势

其中蓝色线为预测结果，黑色点为原数据点。将2018年伊拉克发生恐怖袭击的次数的预测图进行放大，可以看到在2018年3、6月份会有明显上升，而在5、10月份之后会有明显的下降，模型得出预测趋势大致与接下来趋势分析中的季节性趋势一致。
对伊拉克地区近三年来发生的恐怖袭击事件进行了季节性分析和趋势分析。

<img src="https://github.com/michelleweii/GTD-mathematical-modeling/blob/master/数学建模git上传/assignment3/图%204-12%20伊拉克恐怖袭击趋势图.png" width="600" alt="note3">
图 伊拉克恐怖袭击趋势图

由于Prophet使用加性模型，y轴代表相对于趋势的绝对变化。从表中我们得知，6月的飙升发生在斋月结束之前，12月的跳跃发生在默罕默德诞辰之后。9月份的下降发生在古尔邦节和伊斯兰新年附近。与此同时，周五发生的攻击次数较少，与穆斯林星期五祈祷相对应。总体遭到恐怖袭击趋势呈下降状态，分析得出的预测趋势与上述趋势分析中显示的季节性趋势一致。

## 任务4 数据的进一步利用
你们认为通过数学建模还可以发挥附件1数据的哪些作用？给出你们的模型和方法。
### 任务四解决方案
（1）利用数据集中所显示的恐怖袭击中使用的武器，按照其类型进行分类，此问题提出的依据如图所示

<img src="https://github.com/michelleweii/GTD-mathematical-modeling/blob/master/数学建模git上传/武器类型统计图.PNG" width="500" alt="note3">

图片显示爆炸袭击，枪炮，以及不知具体武器的攻击类型占了前三位。所以根据显示结果，利用附件1的数据建立了武器分类模型，以便预测出来武器攻击类型以做好未来针对该武器类型的防范。
- 支持向量机

在武器分类问题中，选定的特征为：'country_txt', 'region_txt', 'attacktype1_txt', 'nkill','nwound'。预测标签为’weapontype1’。给定训练样本集D={(x_i,y_i ),i=1,2,⋯,N},x∈R^d,y∈{±1}，x_i为第i个特征向量，y_i为x_i的类标记。利用SVM分类器对武器类型进行分类，实验准确率为0.8895805739514349

（2） 自然语言处理是人工智能最早的研究领域之一，通过对附件1数据分析得知有summary和country_txt两个特征。利用Seq2Seq模型对这两个属性进行数学建模。我们所要解决的问题是根据summary内容预测出country_txt中的内容。在数据分析领域，数据集严重影响着分析结果，每一条数据都很珍贵，如果country_txt内容丢失，我们完全可以从summary中预测出结果，而不必删除缺失值的数据。
- Seq2Seq模型

Seq2Seq模型的基本思想非常简单，通过使用一个循环神经网络读取输入句子，将整个句子的信息压缩到一个固定维度的编码中；再使用另一个循环神经网络读取这个编码，将其解压为目标语言的一个句子。这两个循环神经网络分别称为编码器（Encoder）和解码器(Decoder)，这个模型也称为Encoder-Decoder模型。

编码器部分的结构与语言模型几乎完全相同：输入为单词的词向量，输出为softmax层产生的单词概率。

解码器与编码器一样拥有词向量层和循环神经网络，在训练过程中，编码器顺序读入每个单词的词向量，然后将最终的隐藏状态复制到解码器作为初始状态。解码器的第一个输入是特殊的<Go>字符，每一步预测的单词是训练数据的目标句子，预测序列的最后一个单词是与语言模型相同的<EOS>(End-Of-Sentence)字符。在解码过程中，每一步预测的单词中概率最大的单词被选为这一步的输出，并复制到下一步的输入中。
 
针对我们要解决的问题，结合Seq2Seq模型给出下列示意图。
<img src="https://github.com/michelleweii/GTD-mathematical-modeling/blob/master/数学建模git上传/seq2seq.PNG" width="500" alt="note3">

上述示意图简要的描述了Seq2Seq模型生成country_txt的步骤。首先在Encoder端，将文本处理为数字并且进行Word Embedding（当前单词对应的单词向量）之后输入到长短期记忆网络（LSTM）层，Encoder端通过学习输入数据，将其编码成一个固定大小的状态S，继而将S传给Decoder端，Decoder端再通过对状态向量S的学习来进行输出。

<img src="https://github.com/michelleweii/GTD-mathematical-modeling/blob/master/数学建模git上传/文本预测.PNG" width="500" alt="note3">

